/* STRING_REF.asm * Takes a string and an index n and Returns in R0 the char in index n of the string */ STRING_REF:  PUSH(FP);  MOV(FP, SP);  PUSH(R1);    CMP(FPARG(1), IMM(2));  JUMP_LT(HAS_NO_ARGS_STRING_REF);  JUMP_GT(TOO_MANY_ARGS_STRING_REF);  CMP(IND(FPARG(2)),T_STRING);  JUMP_NE(NOT_VALID_ARG_STRING_REF);  CMP(IND(FPARG(3)),T_INTEGER);  JUMP_NE(NOT_VALID_ARG_STRING_REF);  CMP(INDD(FPARG(3),1),0);  JUMP_LT(NOT_VALID_ARG_STRING_REF);  MOV(R1,INDD(FPARG(3),1));  CMP(R1,INDD(FPARG(2),1));  JUMP_GE(NOT_VALID_ARG_STRING_REF);  ADD(R1,IMM(2));  PUSH(INDD(FPARG(2),R1));  CALL(MAKE_SOB_CHAR);  DROP(1);   POP(R1);  POP(FP);  RETURN;    NOT_VALID_ARG_STRING_REF:  CALL(ERROR_NOT_VALID_ARG);    HAS_NO_ARGS_STRING_REF:  CALL(ERROR_NOT_ENOUGH_ARGS);    TOO_MANY_ARGS_STRING_REF:  CALL(ERROR_TOO_MANY_ARGS);